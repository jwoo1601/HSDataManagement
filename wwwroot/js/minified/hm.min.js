function showLoadingDialog(n,t){$("input, select, textarea",$(n)).prop("readonly",!0);var i=$("#loadingModal");$(".loading-text",i).text(t);i.modal({backdrop:"static",keyboard:!1})}function hideLoadingDialog(n){$("input, select, textarea",$(n)).prop("readonly",!1);$("#loadingModal").modal("hide")}function openLoadingDialog(n,t,i){i&&$("input, select, textarea",$(i)).prop("readonly",!0);var r=$("#loadingModal");$(".loading-text",r).text(n);r.modal({backdrop:"static",keyboard:!1});t(()=>{i&&$("input, select, textarea",$(i)).prop("readonly",!1),r.modal("hide")})}function openConfirmationDialog(n,t,i,r){var u=$("#confirmationModal");$(".modal-title",u).text(n);$(".modal-message",u).text(t);$("[data-action=confirm]",u).one("click",function(){u.modal("hide");i()});$("[data-action=cancel]",u).one("click",function(){r&&r()});u.modal({backdrop:"static",keyboard:!1})}function openErrorDialog(n,t){var i=$("#errorModal");$(".modal-title",i).text(n);$(".modal-message",i).text(t);i.modal({backdrop:"static"})}function redirectTo(n){window.location.href=n}function addCustomTag(n){addCustomTagWithText(n,"새 태그")}function addCustomTagWithText(n,t){var i=$(`<div class="custom-tag"><span class="custom-tag-text" contenteditable>${t}</span></div>`);$(".custom-tag-text",i).after('<span class="custom-tag-remove oi oi-x ml-2" aria-hidden="true"><\/span>');$(".custom-tag-text",i).focusout(function(){$(this).text().length===0&&i.remove()});$(".custom-tag-remove",i).click(function(){i.remove()});i.insertBefore($(".add-custom-tag",n))}function clearForm(n){$(n).find("input, select, textarea").val("");$(n).find("input[type=checkbox], input[type=radio]").prop("checked",!1);$(n).find(".custom-tag-container .custom-tag").remove();$(n).removeClass("was-validated")}function showLoadingDialog(n,t){$("input, select, textarea",$(n)).prop("readonly",!0);var i=$("#loadingModal");$(".loading-text",i).text(t);i.modal({backdrop:"static",keyboard:!1})}function hideLoadingDialog(n){$("input, select, textarea",$(n)).prop("readonly",!1);$("#loadingModal").modal("hide")}function openLoadingDialog(n,t,i){i&&$("input, select, textarea",$(i)).prop("readonly",!0);var r=$("#loadingModal");$(".loading-text",r).text(n);r.modal({backdrop:"static",keyboard:!1});t(()=>{i&&$("input, select, textarea",$(i)).prop("readonly",!1),r.modal("hide")})}function openConfirmationDialog(n,t,i,r){var u=$("#confirmationModal");$(".modal-title",u).text(n);$(".modal-message",u).text(t);$("[data-action=confirm]",u).one("click",function(){u.modal("hide");i()});$("[data-action=cancel]",u).one("click",function(){r&&r()});u.modal({backdrop:"static",keyboard:!1})}function redirectTo(n){window.location.href=n}function saveCustomerFromModal(n,t,i){var r=$("form",n);openLoadingDialog("저장 중",u=>{var o=$("input[name=name]",r).val(),h=$("input[name=admission_date]",r).val(),c=$("input[name=discharge_date]",r).val(),l=$(".custom-tag-container .custom-tag",r).map(function(){return $(this).text()}).get(),a=$("textarea[name=note]",r).val(),s,f,e;if(o.trim()===""){u();return}r.addClass("was-validated");r.get(0).checkValidity()?(s={name:o,admissionDate:h,dischargeDate:c,tags:l,note:a},t==="add"?(f="/api/customers",e="POST"):(f=`/api/customers/${i}`,e="PUT"),hm.sendAsync(e,f,{data:s}).done(function(){fetchCustomerListWithSettings()}).always(function(){u();$(n).modal("hide")})):u()},r)}function filterCustomerTable(n,t){var i=$("#customerTable");$("tbody tr",i).hide();$("tbody tr",i).filter(function(){var i=$(`[data-category=${n}]`,this).text();return i.includes(t)}).show()}function setPageNumber(n){n=Math.max(1,n);$("form[name=sortingSettings] input[name=pageNumber]").val(n);$(".pagination .page-link[data-page]").text(n)}function getPageNumber(){return parseInt($("form[name=sortingSettings] input[name=pageNumber]").val())}function fetchCustomerListWithSettings(){var n=$("form[name=sortingSettings]"),t=$("[name=pageNumber]").val(),i=$("[name=numItems]").val(),r=$("[name=sortingCriteria]",n).val(),u=$("[name=sortingOrder]",n).val();return fetchCustomerList({page:t,limit:i,criteria:r,order:u})}function fetchCustomerList(n){var i="/customer/display",t=[];return n=n||{},n.page&&t.push(`page=${n.page}`),n.limit&&t.push(`limit=${n.limit}`),n.criteria&&t.push(`criteria=${n.criteria}`),n.order&&t.push(`order=${n.order}`),t.length>0&&(i+="?"+t.join("&")),hm.getAsync(i,{responseType:"html"}).done(function(n){$("#customerTable tbody").html(n);bindCustomerActions();hm.getAsync("/api/customers").done(function(n){$("#numCustomers").text(`${$("#customerTable tbody tr").length} / ${n.length}`)})})}function bindCustomerActions(){var n=$("[data-customer-id]");$("[data-action=edit]",n).click(function(){openLoadingDialog("로딩 중",n=>{var t=$(this).closest("tr"),i=t.data("customer-id");$.ajax(`/api/customers/${i}`).done(function(n,t,r){var f=r.responseJSON,u=$("#editCustomerModal");$("form",u).clearFm();$("input[name=id]",u).val(`${i}`);$("input[name=name]",u).val(f.name);$("input[name=admission_date]",u).val(f.admission_date);$("input[name=discharge_date]",u).val(f.discharge_date);f.tags.forEach(n=>{$(".custom-tag-container",u).customTagFm(n)});$("textarea[name=note]",u).val(f.note);$("#editCustomerModal").modal({backdrop:"static"})}).fail(function(){t.remove()}).then(function(){n()})})});$("[data-action=visibility]",n).click(function(){openLoadingDialog("변경 중",n=>{var t=$(this).closest("tr"),r=t.data("customer-id"),i=!JSON.parse(t.data("visibility")),u={isVisible:i};$.ajax(`/api/customers/options/${r}`,{method:"PUT",data:JSON.stringify(u),contentType:"application/json"}).done(function(){var n=i.toString();t.data("visibility",n);$("input[name=visibility]",t).prop("checked",i);$("[data-action=visibility] .btn-text",t).text(i?"숨김":"보임")}).then(function(){n()})})});$("[data-action=delete]",n).click(function(){openConfirmationDialog("고객 정보 제거",`정말로 해당 고객의 정보를 모두 제거하시겠습니까? (제거 후 다시 되돌릴 수 없습니다.)`,()=>{openLoadingDialog("삭제 중",n=>{var t=$(this).closest("tr"),i=t.data("customer-id");$.ajax(`/api/customers/delete/${i}`,{method:"DELETE"}).then(function(){fetchCustomerListWithSettings();n()})})})})}function sortTableByCategory(n,t,i){var r=$(`th[data-category="${t}"]`,n).index(),u=$("tbody tr:not([data-sort=none])",n).detach().get().map(n=>[$("td",$(n)).get(r),n]).sort((n,t)=>{var[f]=n,[e]=t,r=$(f).data("value")||$(f).text(),u=$(e).data("value")||$(e).text();return r==u?0:i&&i.toLowerCase()==="desc"?r<u?1:-1:r>u?1:-1});return u.forEach([,t]=>{$("tbody",n).append($(t))}),n}function getTableOptions(n){var t=$("form[name=tableOptions]").filter(function(){return $(this).data("target")===`#${n.attr("id")}`}),i=n.data("page"),r=$("[name=numItems]",t).val(),u=$("[name=criteria]",t).val(),f=$("[name=order]",t).val();return{page:i||1,numItems:r||10,criteria:u||"id",order:f||"asc"}}function fetchTableData(n,t,i={}){function u(n,t,i){return $.ajax(t).done(function(t,r,u){var f=u.responseJSON;f.forEach(t=>{addTableEntry(n,t,i)})})}var r={silent:i.silent===undefined?!1:i.silent,valueMappers:i.valueMappers||{}};return $("tbody tr:not(.sample-row)",n).remove(),r.silent?u(n,t,r.valueMappers):openLoadingDialog("데이터 로딩 중",i=>{u(n,t,r.valueMappers).then(function(){i()})}),n}function addTableEntry(n,t,i){var u=$(".sample-row",n),r;return u.length===0?n:(r=u.clone(),Object.keys(t).forEach(u=>{var s=$(`th[data-category="${u}"]`,n),h=s.index(),f,c,o,e;h<0||(f=$("td",r).get(h),c=i[u]?i[u]:n=>n,o=c(t[u]),typeof s.data("norender")=="undefined"&&(e=$("[data-render-target]",f),e.length===0&&(e=$(f)),e.text(o)),$(f).data("value",o))}),r.data("row-id",t.id).removeClass(["d-none","sample-row"]).removeAttr("data-sort"),$("tbody",n).append(r),n)}function tablePagination(n,t={}){var r={numItems:t.numItems||10},i=$("tbody tr:not(.sample-row)",n),u;return i.length!==0&&(i.each(function(n){$(this).data("page",Math.floor(n/r.numItems+1))}),tableNavigatePage(n,1)),u=Math.ceil(i.length/r.numItems),n.trigger("table.hm.paginate",{numPages:u}),n}function tableNavigatePage(n,t){var i=jQuery.Event("table.hm.navigate"),r;return i.isDefaultPrevented()||(n.data("current-page",t),r=$("tbody tr:not(.sample-row)",n),r.hide().filter(function(){return $(this).data("page")==t}).show(),i.navigatedPage=t,n.trigger(i)),n}function tableGetCurrentPage(n){return n.data("current-page")}function tableFilterByCategory(n,t,i){var u=jQuery.Event("table.hm.filter"),r;u.isDefaultPrevented()||(r=$("tbody tr:not(.sample-row)",n),r.hide().filter(function(){}),typeof i=="function")}function openAddFoodCategoryDialog(){openFoodCategoryDetailDialog("add")}function openEditFoodCategoryDialog(n){openFoodCategoryDetailDialog("edit",{rowId:n})}function openFoodCategoryDetailDialog(n,t){var i=$(`#${n}FoodCategoryModal`),r=$(`form[name=${n}FoodCategory]`).clearFm();n==="add"?(close(),i.modal({backdrop:"static"})):n==="edit"&&openLoadingDialog("로딩 중",n=>{r.fetchAsyncFm(`/api/nutrition-support/foods/categories/${t.rowId}`).done(function(){n();i.modal({backdrop:"static"})}).fail(function(){n();openErrorDialog("오류","카테고리 데이터를 불러올 수 없습니다. 잠시 후 다시 시도해 주십시오.")})})}function fetchFoodCategoryList(){var n=$("#foodCategoryTable");return n.fetchDataTbl("/api/nutrition-support/foods/categories").done(function(t){$("tbody tr:not(.sample-row)",n).each(function(){var i=t.find(n=>n.id===$(this).data("row-id")).note,n;i&&(n=$("[data-action=detail]",this),n.tooltip({container:n,placement:"right",title:i,trigger:"hover"}))})})}function openAddFoodIngredientDialog(){openFoodIngredientDetailDialog("add")}function openEditFoodIngredientDialog(n){openFoodIngredientDetailDialog("edit",{rowId:n})}function openFoodIngredientDetailDialog(n,t){var i=$(`#${n}FoodIngredientModal`),r=$(`form[name=${n}FoodIngredient]`).clearFm();n==="add"?(close(),i.modal({backdrop:"static"})):n==="edit"&&openLoadingDialog("로딩 중",n=>{r.fetchAsyncFm(`/api/nutrition-support/foods/ingredients/${t.rowId}`).done(function(){n();i.modal({backdrop:"static"})}).fail(function(){n();openErrorDialog("오류","재료 데이터를 불러올 수 없습니다. 잠시 후 다시 시도해 주십시오.")})})}function fetchFoodIngredientList(){return $("#foodIngredientTable").fetchDataTbl("/api/nutrition-support/foods/ingredients")}function fetchFoodList(){var n=$("#foodTable");return n.fetchDataTbl("/api/nutrition-support/foods",{valueMappers:{category:n=>n.name,ingredients:n=>n.length}}).done(function(t){$("tbody tr:not(.sample-row)",n).each(function(){var n=$("[data-action=detail]",this);n.tooltip({container:n,placement:"bottom",title:t.find(n=>n.id===$(this).data("row-id")).ingredients.map(n=>`${n.name} (${n.origin})`).join(", "),trigger:"hover"})})})}function openAddFoodDialog(){openFoodDetailDialog("add")}function openEditFoodDialog(n){openFoodDetailDialog("edit",{rowId:n})}function openFoodDetailDialog(n,t){var i=$(`#${n}FoodModal`),r=$(`form[name=${n}Food]`).clearFm();openLoadingDialog("로딩 중",u=>{hm.getAsync("/api/nutrition-support/foods/categories").done(function(f){var o=$("[name=category]",r),e;o.find("option.category-entry").remove();f.map(n=>`<option value="${n.id}" class="category-entry">${n.name}</option>`).forEach(n=>{o.append(n)});e=$("[data-category=numIngredients]",r);n==="add"?(i.trigger("data.hm.load"),e.text("0"),u(),i.modal({backdrop:"static"})):n==="edit"&&fetchSelectFoodIngredientsTable().done(function(){r.fetchAsyncFm(`/api/nutrition-support/foods/${t.rowId}`,{setters:{ingredients:function(n){n.forEach(n=>{toggleFoodIngredient(n.id)})},category:function(n){this.val(n.id)}}}).done(function(n){e.text(n.ingredients.length);u();i.modal({backdrop:"static"})}).fail(function(){u();openErrorDialog("오류","음식 데이터를 불러올 수 없습니다. 잠시 후 다시 시도해 주십시오.")})}).fail(function(){u();openErrorDialog("오류","재료 목록을 불러올 수 없습니다. 잠시 후 다시 시도해 주십시오.")})}).fail(function(){u();openErrorDialog("오류","카테고리 목록을 불러올 수 없습니다. 잠시 후 다시 시도해 주십시오.")})})}function fetchSelectFoodIngredientsTable(){return $("#selectFoodIngredientsTable").fetchDataTbl("/api/nutrition-support/foods/ingredients")}function toggleFoodIngredient(n){var r=$("#selectFoodIngredientsTable"),t,i;$("tbody tr:not(.sample-row)",r).filter(function(){return $(this).data("row-id")===n}).toggleClass("selected");t="";i=$("tbody tr.selected",r).length;i!==0&&(t=`(${i}개 선택됨)`);$("#selectFoodIngredientsModal .modal-footer .message").text(t)}function openSelectFoodIngredientsDialog(n){$("#selectFoodIngredientsModal").data("bind-target",n).modal({backdrop:"static",keyboard:!1})}function displayMenuListInitialTab(){isInitialTabShown||($("#menuListTabFood").tab("show"),isInitialTabShown=!0)}function getCurrentMenuCategory(){return $("#menuListTabBar .nav-link.active").data("category")}function reloadCalendar(){updateCalendarHeader();assignCalendarDates()}function weekOfMonth(n){return[1,2,3,4,5][0|moment(n).date()/7]}function weekOfMonthWithOFfset(n){var t=n.clone().startOf("month"),i=t.clone().startOf("week"),r=t.diff(i,"days");return Math.ceil((n.date()+r)/7)}function updateCalendarHeader(){var t=$("form[name=datePeriod]"),n=moment($("[name=startDate]",t).val()),e=moment($("[name=endDate]",t).val()),i=$("#weeklyCalendar"),r=n.year(),u=n.month()+1,f=weekOfMonth(n);$(".month-and-week",i).text(`${u}월 ${FmtOrdinal.toOrdinal(f,2,"째")} 주`);$(".year",i).text(r)}function assignCalendarDates(){var t=$("#weeklyCalendar"),i=$(".hm-calendar-body",t),n=$("form[name=datePeriod]"),r=moment($("[name=startDate]",n).val()),u=moment($("[name=endDate]",n).val());$("thead th",i).each(function(n){$(".hm-calendar-date",this).text(r.clone().day(n).format("M/D"))})}const hm={};$(function(){$("[data-toggle=tooltip]").tooltip({boundary:"window"});$("#loginBtn").click(function(){redirectTo("/login")});$("#registerBtn").click(function(){redirectTo("/register")});$("input.numeric-only").keyup(function(){/[^0-9]|^0+(?!$)/g.test(this.value)&&(this.value=this.value.replace(/[^0-9]|^0+(?!$)/g,""))});$(".modal[data-trigger-action]").on("show.bs.modal",function(){switch($(this).data("trigger-action")){case"form-reset":$("form",this).clearFm();break;case"clear-table":$("table",this).clearTbl()}});$("form").not("[data-legacy]").on("submit",function(n){n.preventDefault()})});$(function(){$("[data-toggle=tooltip]").tooltip({boundary:"window"});$("#loginBtn").click(function(){$("#loginModal").modal({backdrop:"static",keyboard:!1})});$("#registerBtn").click(function(){redirectTo("/account/register")});$("input.numeric-only").keyup(function(){/[^0-9]|^0+(?!$)/g.test(this.value)&&(this.value=this.value.replace(/[^0-9]|^0+(?!$)/g,""))});$(".add-custom-tag").click(function(){addCustomTag($(this).closest(".custom-tag-container"))});$(".modal[data-trigger-action]").on("show.bs.modal",function(){switch($(this).data("trigger-action")){case"form-reset":clearForm($("form",this))}});$("form[name=tableOptions] [data-action=save]").click(function(){openLoadingDialog("데이터 정렬 중",n=>{var r=$(this).closest("form[name=tableOptions]"),t=$(r.data("target")),i=t.getTableOptions();t.sortTableByCategory(i.criteria,i.order);n()})})});hm.sendAsync=function(n,t,i={}){var r={param:i.param||"",queries:i.queries||{},data:i.data,requestType:i.requestType||"json",responseType:i.responseType||"json"},u;switch(r.requestType){case"text":u="text/plain; charset=UTF-8";break;case"json":u="application/json; charset=UTF-8";break;case"form":u="application/x-www-form-urlencoded; charset=UTF-8"}var f=$.Deferred(),e=r.param!==""?`${t}/${r.param}`:t,o=Object.entries(r.queries).map([n,t]=>`${n}=${t}`).join("&");return o!==""&&(e+=`?${o}`),$.ajax(e,{method:n,data:JSON.stringify(r.data),contentType:u,dataType:r.responseType}).done(function(n,t,i){var n;switch(r.responseType){case"xml":n=i.responseXML;break;case"json":n=i.responseJSON;break;default:n=i.responseText}f.resolve(n)}).fail(function(n){var t;switch(r.responseType){case"xml":t=n.responseXML;break;case"json":t=n.responseJSON;break;default:t=n.responseText}f.reject(t)}),f};hm.getAsync=function(n,t){return hm.sendAsync("GET",n,t)};hm.postAsync=function(n,t,i){return hm.sendAsync("POST",n,Object.assign({},i,{data:t}))};hm.putAsync=function(n,t,i){return hm.sendAsync("PUT",n,Object.assign({},i,{data:t}))};hm.deleteAsync=function(n,t){return hm.sendAsync("DELETE",n,t)};$(function(){var n,t;openLoadingDialog("데이터 로딩 중",n=>{fetchCustomerList().then(function(){n()})});n=$("form[name=searchForm]");$("input[type=search]",n).on("propertychange input",function(t){var r=!1,u,i;r=t.type==="propertychange"?t.originalEvent.propertyName==="value":!0;r&&(u=$("select",n).val(),i=$(this).val(),i===""?$("#customerTable tbody tr").show():filterCustomerTable(u,i))});$("select",n).change(function(){var i=$(this).val(),t=$("input[type=search]",n).val();t===""?$("#customerTable tbody tr").show():filterCustomerTable(i,t)});$("#reloadBtn").click(function(){openLoadingDialog("데이터 로딩 중",n=>{fetchCustomerListWithSettings().then(function(){n()})})});$("#addCustomerBtn").click(function(){$("#addCustomerModal").modal({backdrop:"static"})});$("#addCustomerModal button[data-action=save]").click(function(){saveCustomerFromModal($("#addCustomerModal"),"add")});$("#editCustomerModal button[data-action=save]").click(function(){var n=$("#editCustomerModal");saveCustomerFromModal(n,"edit",$("input[name=id]",n).val())});t=$("form[name=sortingSettings]");t.on("click","[data-action=save]",function(){openLoadingDialog("데이터 로딩 중",n=>{fetchCustomerListWithSettings().then(function(){n()})})});$(".pagination").on("click","#pagePrev",function(){openLoadingDialog("페이지 로딩 중",n=>{setPageNumber(getPageNumber()-1),fetchCustomerListWithSettings().then(function(){n()})})});$(".pagination").on("click","#pageNext",function(){openLoadingDialog("페이지 로딩 중",n=>{setPageNumber(getPageNumber()+1),fetchCustomerListWithSettings().then(function(){n()})})})}),function(n){const t={customTag:".custom-tag",customTagContainer:".custom-tag-container",customTagText:".custom-tag-text",customTagRemove:".custom-tag-remove",customTagAdd:".add-custom-tag"},i={};i.clear=function(i){return i.get(0).reset(),n(i).find(t.customTag,t.customTagContainer).remove(),n(i).removeClass("was-validated"),i};i.fetchAsync=function(t,i,r={}){const u={setters:r.setters||{},ignore:r.ignore||[]};return hm.getAsync(i).done(function(i){Object.entries(i).filter([n]=>!u.ignore.includes(n)).forEach([i,r]=>{var f=n(`[name="${i}"], [data-name="${i}"]`,t);f.length!==0&&(u.setters[i]?u.setters[i].call(f,r):f.val(r))})})};i.sendJSONAsync=function(t,i={},r={}){var o=Object.assign({},r,{validators:r.validators||{}}),e;if(n("input, select, textarea",t).removeClass("is-valid").removeClass("is-invalid"),t.addClass("was-validated"),e=t.get(0),!e.checkValidity())return n.Deferred().reject();var s=t.attr("method"),h=t.attr("action"),u={};n("input, select, textarea",t).not("[data-ignore]").not("[type=checkbox]").not("[type=radio]").each(function(){var t=n(this).get(0).name,i=n(this).val();u[t]=i});n("input[type=checkbox], input[type=radio]",t).not("[data-ignore]").filter(function(){return n(this).prop("checked")}).each(function(){var t=n(this).get(0).name,i=n(this).prop("checked");u[t]=i});const f=n(".custom-tag-container .custom-tag",t);return f.length>0&&(u[f.data("name")]=f.map(function(){return n(this).text()}).get()),u=Object.assign({},u,i),hm.sendAsync(s,h,Object.assign({},o,{data:u})).fail(function(i){if(!i.errors){openErrorDialog("오류",i);return}Object.entries(i.errors).forEach([i,r]=>{var f=n(`[name=${i}], [data-name=${i}]`,t).addClass("is-invalid"),e=f.get(0),u;e&&e.setCustomValidity&&e.setCustomValidity(r[0]);u=f.siblings(".invalid-feedback, .invalid-tooltip");u.length>0?u.text(r[0]):u=n(`<div class="invalid-feedback">${r[0]}</div>`).insertAfter(f)})})};i.customTag=function(i,r){i.addClass(t.customTagContainer);var u=n(`<div class="custom-tag"><span class="custom-tag-text" contenteditable>${r||"새 태그"}</span></div>`);return n(t.customTagText,u).after('<span class="custom-tag-remove oi oi-x ml-2" aria-hidden="true"><\/span>'),n(t.customTagText,u).focusout(function(){n(this).text().length===0&&u.remove()}),n(t.customTagRemove,u).click(function(){u.remove()}),u.insertBefore(n(t.customTagAdd,i)),u};Object.entries(i).forEach([i,t]=>{n.fn[`${i}Fm`]=function(){return t(this,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}});n(t.customTagAdd).click(function(){n(this).closest(t.customTagContainer).customTagFm()})}(jQuery),function(n){const t={};t.sortByCategory=function(t,i,r="asc"){var u=n(`th[data-category="${i}"]`,t).index(),f=n("tbody tr:not([data-sort=none])",t).detach().get().map(t=>[n("td",n(t)).get(u),t]).sort((t,i)=>{var[e]=t,[o]=i,u=n(e).data("value")||n(e).text(),f=n(o).data("value")||n(o).text();return u==f?0:r&&r.toLowerCase()==="desc"?u<f?1:-1:u>f?1:-1});return f.forEach([,i]=>{n("tbody",t).append(n(i))}),t};t.getOptions=function(t){var i=n("form[name=tableOptions]").filter(function(){return n(this).data("target")===`#${t.attr("id")}`}),r=n("[name=numItems]",i).val(),u=n("[name=criteria]",i).val(),f=n("[name=order]",i).val();return{numItems:r||10,criteria:u||"id",order:f||"asc"}};t.fetchData=function(i,r,u={}){function o(){return hm.getAsync(r).done(function(n){var r=jQuery.Event("table.hm.fetch");r.isDefaultPrevented()||(r.ajaxData=n,n.forEach(n=>{t.addRowFromObject(i,n,e.valueMappers)}),i.trigger(r));f.resolve(n)}).fail(function(n){f.reject(n)})}var e={silent:u.silent===undefined?!1:u.silent,valueMappers:u.valueMappers||{}},f=n.Deferred();return t.clear(i),e.silent?o():openLoadingDialog("데이터 로딩 중",n=>{o().always(function(){n()})}),f};t.clear=function(t){return n("tbody tr:not(.sample-row)",t).remove(),t};t.addRowFromObject=function(t,i,r){var f=n(".sample-row",t),u;return f.length===0?t:(u=f.clone(),Object.keys(i).forEach(f=>{var h=n(`th[data-category="${f}"]`,t),c=h.index(),e,l,s,o;c<0||(e=n("td",u).get(c),l=r[f]?r[f]:n=>n,s=l(i[f]),typeof h.data("norender")=="undefined"&&(o=n("[data-render-target]",e),o.length===0&&(o=n(e)),o.text(s)),n(e).data("value",s))}),u.data("row-id",i.id).removeClass(["d-none","sample-row"]).removeAttr("data-sort"),n("tbody",t).append(u),t)};t.pagination=function(i,r={}){var e={numItems:r.numItems||10},u=n("tbody tr:not(.sample-row)",i),f;return u.length!==0&&u.each(function(t){n(this).data("page",Math.floor(t/e.numItems+1))}),f=Math.ceil(u.length/e.numItems),t.pages(i,f),i.trigger("table.hm.paginate",{numPages:f}),t.navigatePage(i,1),i};t.navigatePage=function(i,r){var f=t.pages(i),u,e;return r<1||f&&r>f?i:(u=jQuery.Event("table.hm.navigate"),u.isDefaultPrevented()||(t.currentPage(i,r),e=n("tbody tr:not(.sample-row)",i),e.hide().filter(function(){return n(this).data("page")==r}).show(),u.navigatedPage=r,i.trigger(u)),i)};t.currentPage=function(n,t){return t?n.data("current-page",t):n.data("current-page")};t.pages=function(n,t){return t?n.data("pages",t):n.data("pages")};t.filterByCategory=function(t,i,r){var o=jQuery.Event("table.hm.filter"),f,u,e;return o.isDefaultPrevented()?n():(f=n(`th[data-category="${i}"]`,t),u=f.index(),u<0)?n():(e=n("tbody tr:not(.sample-row)",t),e.filter(function(){var t=""+n(n("td",this).get(u)).data("value");return typeof r=="string"?t.includes(r):typeof r=="function"?r(t):t===r}))};Object.entries(t).forEach([i,t]=>{n.fn[`${i}Tbl`]=function(){return t(this,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}});n("form[name=tableOptions] [data-action=save]").click(function(){openLoadingDialog("데이터 정렬 중",t=>{var u=n(this).closest("form[name=tableOptions]"),r=n(u.data("target")),i=r.getOptionsTbl();r.paginationTbl({numItems:i.numItems}).sortByCategoryTbl(i.criteria,i.order);t()})});n(".tablePagination").on("click","[data-action=prev]",function(){var i=n(this).closest(".tablePagination"),t=n(i.data("target"));t.navigatePageTbl(t.currentPageTbl()-1)}).on("click","[data-action=next]",function(){var i=n(this).closest(".tablePagination"),t=n(i.data("target"));t.navigatePageTbl(t.currentPageTbl()+1)});n("table").on("table.hm.fetch",function(){var t=n(this).getOptionsTbl();n(this).paginationTbl({numItems:t.numItems}).sortByCategoryTbl(t.criteria,t.order)}).on("table.hm.navigate",function(t){var i=n(this);n(".tablePagination").filter(function(){return n(this).data("target")===`#${i.attr("id")}`}).find(".page-text").text(`${t.navigatedPage} / ${i.pagesTbl()}`)});n("[data-bind=table]").on("propertychange input",'[data-role="search-filter"][data-action=filter]',function(t){var u=!1;if(u=t.type==="propertychange"?t.originalEvent.propertyName==="value":!0,u){var f=n(this).closest("[data-bind=table]"),i=n(f.data("target")),o=n("[data-role=category]",f).val(),e=n(this).val(),r=i.currentPageTbl();e===""?r?i.navigatePageTbl(r):n("tbody tr",i).show():(n("tbody tr",i).hide(),i.filterByCategoryTbl(o,e).filter(function(){return n(this).data("page")==r}).show())}})}(jQuery),function(){}(jQuery),function(n){n.fn.sortTableByCategory=function(n,t){return sortTableByCategory(this,n,t)};n.fn.getTableOptions=function(){return getTableOptions(this)};n.fn.fetchTableData=function(n,t){return fetchTableData(this,n,t)};n.fn.addTableEntry=function(n,t){return addTableEntry(this,n,t)};n.fn.tablePagination=function(n){return tablePagination(this,n)};n.fn.tableNavigatePage=function(n){return tableNavigatePage(this,n)};n.fn.tableCurrentPage=function(){return tableGetCurrentPage(this)}}(jQuery);$(function(){$("#menuListTabCategory").one("shown.bs.tab",function(){fetchFoodCategoryList()});$("#foodCategoryTable").on("click",".show-edit-dialog",function(){openEditFoodCategoryDialog($(this).closest("tr").data("row-id"))}).on("click","[data-action=delete]",function(){openConfirmationDialog("메뉴 삭제","정말로 해당 카테고리를 삭제하시겠습니까? (다시 되돌릴 수 없습니다.)",()=>{openLoadingDialog("삭제 중",n=>{var t=$(this).closest("tr");hm.deleteAsync("/api/nutrition-support/foods/categories/delete",{param:t.data("row-id")}).done(function(){fetchFoodCategoryList().always(function(){n()})}).fail(function(){n();openErrorDialog("카테고리 삭제 오류","해당 카테고리 삭제를 실패하였습니다. 잠시 후 다시 시도해주세요.")})})})});$("#addFoodCategoryModal").on("click","[data-action=save]",function(){var n=$(this).closest(".modal");openLoadingDialog("저장 중",t=>{$("form[name=addFoodCategory]",n).sendJSONAsyncFm().done(function(){fetchFoodCategoryList().always(function(){n.modal("hide")})}).always(function(){t()})})});$("#editFoodCategoryModal").on("click","[data-action=save]",function(){var n=$(this).closest(".modal");openLoadingDialog("변경사항 저장 중",t=>{$("form[name=editFoodCategory]",n).sendJSONAsyncFm({},{param:$("[name=id]",n).val()}).done(function(){fetchFoodCategoryList().always(function(){n.modal("hide")})}).always(function(){t()})})})});$(function(){$("#menuListTabIngredient").one("shown.bs.tab",function(){fetchFoodIngredientList()});$("#foodIngredientTable").on("click",".show-edit-dialog",function(){openEditFoodIngredientDialog($(this).closest("tr").data("row-id"))}).on("click","[data-action=delete]",function(){openConfirmationDialog("메뉴 삭제","정말로 해당 재료를 삭제하시겠습니까? (다시 되돌릴 수 없습니다.)",()=>{openLoadingDialog("삭제 중",n=>{var t=$(this).closest("tr");hm.deleteAsync("/api/nutrition-support/foods/ingredients/delete",{param:t.data("row-id")}).done(function(){fetchFoodIngredientList().always(function(){n()})}).fail(function(){n();openErrorDialog("재료 삭제 오류","해당 재료 삭제를 실패하였습니다. 잠시 후 다시 시도해주세요.")})})})});$("#addFoodIngredientModal").on("click","[data-action=save]",function(){var n=$(this).closest(".modal");openLoadingDialog("저장 중",t=>{$("form[name=addFoodIngredient]",n).sendJSONAsyncFm().done(function(){fetchFoodIngredientList().always(function(){n.modal("hide")})}).always(function(){t()})})});$("#editFoodIngredientModal").on("click","[data-action=save]",function(){var n=$(this).closest(".modal");openLoadingDialog("변경사항 저장 중",t=>{$("form[name=editFoodIngredient]",n).sendJSONAsyncFm({},{param:$("[name=id]",n).val()}).done(function(){fetchFoodIngredientList().always(function(){n.modal("hide")})}).always(function(){t()})})})});$(function(){$("#menuListTabFood").one("shown.bs.tab",function(){fetchFoodList()});$("#foodTable").on("click",".show-edit-dialog",function(){openEditFoodDialog($(this).closest("tr").data("row-id"))}).on("click","[data-action=delete]",function(){openConfirmationDialog("메뉴 삭제","정말로 해당 메뉴를 삭제하시겠습니까? (다시 되돌릴 수 없습니다.)",()=>{openLoadingDialog("삭제 중",n=>{var t=$(this).closest("tr");hm.deleteAsync("/api/nutrition-support/foods/delete",{param:t.data("row-id")}).done(function(){fetchFoodList().always(function(){n()})}).fail(function(){n();openErrorDialog("메뉴 삭제 오류","해당 메뉴 삭제를 실패하였습니다. 잠시 후 다시 시도해주세요.")})})})});$("[data-action=select-ingredients]").on("click",function(){var n=$(this).closest(".modal").modal("hide");openSelectFoodIngredientsDialog(n)});$("#addFoodModal").on("data.hm.load",function(){fetchSelectFoodIngredientsTable()}).on("click","[data-action=save]",function(){var n=$(this).closest(".modal");openLoadingDialog("저장 중",t=>{$("form[name=addFood]",n).sendJSONAsyncFm({ingredients:$("#selectFoodIngredientsTable tbody tr.selected").map(function(){return $(this).data("row-id")}).get()}).done(function(){fetchFoodList().always(function(){n.modal("hide")})}).always(function(){t()})})});$("#editFoodModal").on("click","[data-action=save]",function(){var n=$(this).closest(".modal");openLoadingDialog("변경사항 저장 중",t=>{$("form[name=editFood]",n).sendJSONAsyncFm({ingredients:$("#selectFoodIngredientsTable tbody tr.selected").map(function(){return $(this).data("row-id")}).get()},{param:$("[name=id]",n).val()}).done(function(){fetchFoodList().always(function(){n.modal("hide")})}).always(function(){t()})})});$("#selectFoodIngredientsModal").on("click","[data-action=reload]",function(){openLoadingDialog("데이터 로딩 중",n=>{fetchSelectFoodIngredientsTable().done(function(){n()}).fail(function(){n();openErrorDialog("연결 오류","데이터를 불러올 수 없습니다. 다시 시도해 주십시오.")})})}).on("click","[data-action=select]",function(){var n=$(this).closest(".modal"),t=n.data("bind-target");$("[data-category=numIngredients]",t).text($("#selectFoodIngredientsTable tbody tr.selected",n).length);n.modal("hide");t.modal({backdrop:"static"})}).on("click","[data-action=cancel]",function(){var n=$(this).closest(".modal"),t=n.data("bind-target");$("#selectFoodIngredientsTable tbody tr.selected").removeClass("selected");$(".modal-footer .message",n).text("");n.modal("hide");t.modal({backdrop:"static"})}).on("click","#selectFoodIngredientsTable tbody tr",function(){toggleFoodIngredient($(this).data("row-id"))})});$(function(){$("#tabMenuList").one("shown.bs.tab",function(){displayMenuListInitialTab()});$("#dropdownBtnMenuList").one("click",function(){displayMenuListInitialTab()});$("[data-category=menuList]").on("click","[data-action=reload]",function(){var n,t=getCurrentMenuCategory();switch(t){case"food":n=fetchFoodList;break;case"category":n=fetchFoodCategoryList;break;case"ingredient":n=fetchFoodIngredientList}n&&n()}).on("click","[data-action=add]",function(){var n,t=getCurrentMenuCategory();switch(t){case"food":n=openAddFoodDialog;break;case"category":n=openAddFoodCategoryDialog;break;case"ingredient":n=openAddFoodIngredientDialog}n&&n()})});var isInitialTabShown=!1;$(function(){$("#tabDropdown .dropdown-item").click(function(){var n=$(this);$("#tabDropdown .dropdown-item").not(this).removeClass("active");$("#tabBar .nav-link.active").removeClass("active");$("#tabBar .nav-link").filter(function(){return $(this).attr("href")===n.attr("href")}).addClass("active");$(this).tab("show")});$("#tabBar .nav-link").on("show.bs.tab",function(){var n=$(this);$("#tabDropdown .dropdown-item.active").removeClass("active");$("#tabDropdown .dropdown-item").filter(function(){return $(this).attr("href")===n.attr("href")}).addClass("active")})});$(function(){$(".nav-link[data-service-id]").click(function(){$(".nav-link[data-service-id]").not(this).removeClass("active")})});$(function(){reloadCalendar();$("form[name=datePeriod]").on("change","[name=startDate]",function(){var n=$(this).closest("form"),t=moment($(this).val()).startOf("week"),i=t.clone().endOf("week");$("[name=startDate]",n).val(t.format("YYYY-MM-DD"));$("[name=endDate]",n).val(i.format("YYYY-MM-DD"));reloadCalendar()})});